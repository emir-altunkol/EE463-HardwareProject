Version 4
SHEET 1 4540 680
WIRE 304 -880 272 -880
WIRE 416 -880 384 -880
WIRE 768 -880 736 -880
WIRE 880 -880 848 -880
WIRE 304 -720 272 -720
WIRE 416 -720 384 -720
WIRE 768 -720 736 -720
WIRE 880 -720 848 -720
WIRE 672 -544 640 -544
WIRE 784 -544 752 -544
WIRE 2496 -400 2080 -400
WIRE 3728 -400 3312 -400
WIRE 1712 -368 1712 -416
WIRE 2080 -368 2080 -400
WIRE 2944 -368 2944 -416
WIRE 3312 -368 3312 -400
WIRE 2496 -352 2496 -400
WIRE 3728 -352 3728 -400
WIRE 1712 -240 1712 -288
WIRE 2944 -240 2944 -288
WIRE 2080 -208 2080 -288
WIRE 2112 -208 2080 -208
WIRE 3312 -192 3312 -288
WIRE 3344 -192 3312 -192
WIRE 2496 -176 2496 -272
WIRE 3728 -176 3728 -272
WIRE 4096 -160 4096 -208
WIRE 112 -128 96 -128
WIRE 192 -128 176 -128
WIRE 464 -128 192 -128
WIRE 688 -128 464 -128
WIRE 1104 -128 688 -128
WIRE 688 -96 688 -128
WIRE 1104 -96 1104 -128
WIRE 1712 -80 1712 -160
WIRE 2944 -80 2944 -160
WIRE 464 -64 464 -128
WIRE 4096 -48 4096 -80
WIRE 3344 -32 3312 -32
WIRE 2496 32 2496 -96
WIRE 3728 32 3728 -96
WIRE 688 48 688 0
WIRE 688 48 672 48
WIRE 1104 48 1104 0
WIRE 1104 48 1088 48
WIRE 96 64 96 -128
WIRE 192 80 192 -128
WIRE 464 80 464 16
WIRE 464 96 464 80
WIRE 688 96 688 48
WIRE 816 96 688 96
WIRE 1104 96 1104 48
WIRE 1104 96 976 96
WIRE 2112 96 2080 96
WIRE 1712 112 1712 0
WIRE 2944 112 2944 0
WIRE 688 192 688 96
WIRE 1104 192 1104 96
WIRE 1712 208 1712 192
WIRE 2080 208 2080 96
WIRE 2224 208 2080 208
WIRE 2496 208 2496 112
WIRE 2496 208 2224 208
WIRE 2944 208 2944 192
WIRE 3312 208 3312 -32
WIRE 3456 208 3312 208
WIRE 3728 208 3728 112
WIRE 3728 208 3456 208
WIRE 464 224 464 176
WIRE 464 224 448 224
WIRE 688 304 688 288
WIRE 688 304 672 304
WIRE 1104 304 1104 288
WIRE 1104 304 1088 304
WIRE 96 320 96 144
WIRE 192 320 192 144
WIRE 192 320 96 320
WIRE 464 320 464 224
WIRE 464 320 192 320
WIRE 688 320 688 304
WIRE 688 320 464 320
WIRE 1104 320 1104 304
WIRE 1104 320 688 320
WIRE 96 352 96 320
FLAG 96 352 0
FLAG 640 -16 V_G1
IOPIN 640 -16 In
FLAG 640 272 V_G2
IOPIN 640 272 In
FLAG 1056 -16 V_G3
IOPIN 1056 -16 In
FLAG 1056 272 V_G4
IOPIN 1056 272 In
FLAG 1088 48 V_S3
IOPIN 1088 48 In
FLAG 672 48 V_S1
IOPIN 672 48 In
FLAG 672 304 V_S2
IOPIN 672 304 In
FLAG 1088 304 V_S4
IOPIN 1088 304 In
FLAG 416 -880 V_G1
IOPIN 416 -880 Out
FLAG 272 -880 V_S1
IOPIN 272 -880 Out
FLAG 416 -720 V_G2
IOPIN 416 -720 Out
FLAG 272 -720 V_S2
IOPIN 272 -720 Out
FLAG 880 -880 V_G3
IOPIN 880 -880 Out
FLAG 736 -880 V_S3
IOPIN 736 -880 Out
FLAG 880 -720 V_G4
IOPIN 880 -720 Out
FLAG 736 -720 V_S4
IOPIN 736 -720 Out
FLAG 1712 -416 HB+
IOPIN 1712 -416 In
FLAG 816 96 HB+
IOPIN 816 96 Out
FLAG 976 96 HB-
IOPIN 976 96 Out
FLAG 1712 208 HB-
IOPIN 1712 208 In
FLAG 416 160 V_G5
IOPIN 416 160 In
FLAG 448 224 V_S5
IOPIN 448 224 In
FLAG 784 -544 V_G5
IOPIN 784 -544 Out
FLAG 640 -544 V_S5
IOPIN 640 -544 Out
FLAG -1136 -928 0
FLAG -1536 -928 0
FLAG -1136 -1008 tri
FLAG -1536 -1008 ref1
FLAG -240 -896 0
FLAG -240 -976 out1
FLAG -240 -704 0
FLAG -240 -784 out2
FLAG -1536 -688 0
FLAG -1536 -768 ref2
FLAG -1136 -704 0
FLAG -1136 -784 ref5
FLAG 2224 288 0
FLAG 2944 -416 Va_Motor+
IOPIN 2944 -416 In
FLAG 2944 208 Va_Motor-
IOPIN 2944 208 In
FLAG 3456 288 0
FLAG 4096 -208 Va_Motor+
IOPIN 4096 -208 Out
FLAG 4096 -48 Va_Motor-
IOPIN 4096 -48 Out
FLAG -240 -480 0
FLAG -240 -560 out5
FLAG 3344 -192 Speed_couple-
FLAG 3344 -32 Speed_couple+
FLAG 2112 -208 Speed_couple+
FLAG 2112 96 Speed_couple-
SYMBOL nmos 640 -96 R0
SYMATTR InstName M1
SYMATTR Value IXTH88N30P
SYMBOL nmos 1056 -96 R0
SYMATTR InstName M3
SYMATTR Value IXTH88N30P
SYMBOL voltage 3280 -1056 R90
WINDOW 0 37 30 VLeft 2
WINDOW 3 -55 363 VLeft 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value PULSE(0 10 0.02866m 1p 1p 0.02134m 0.05m 400)
SYMBOL voltage 3280 -1200 R90
WINDOW 0 37 30 VLeft 2
WINDOW 3 -49 364 VLeft 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value PULSE(0 10 0 1p 1p 0.02866m 0.05m)
SYMBOL voltage 864 -880 R90
WINDOW 0 -56 90 VLeft 2
WINDOW 3 48 70 VLeft 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V_GS3
SYMATTR Value 0
SYMBOL voltage 1712 96 R0
SYMATTR InstName Sense_Ia
SYMATTR Value 0
SYMBOL voltage 2496 16 R0
SYMATTR InstName Sense_wm
SYMATTR Value 0
SYMBOL ind 1696 -384 R0
SYMATTR InstName Motor_inductance
SYMATTR Value {L_motor}
SYMBOL ind 2480 -368 R0
SYMATTR InstName Inertia_constant
SYMATTR Value {L_inertia}
SYMBOL res 1696 -256 R0
SYMATTR InstName Motor_resistance
SYMATTR Value {R_motor}
SYMBOL res 2480 -192 R0
SYMATTR InstName Friction
SYMATTR Value {R_loss}
SYMBOL bv 2080 -384 R0
SYMATTR InstName V_torque
SYMATTR Value V=I(Sense_Ia)*K_t
SYMBOL voltage 2688 -1200 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 0 -169 9 Left 2
WINDOW 3 -345 136 Left 2
SYMATTR InstName V_DC_CONST
SYMATTR Value PWL(0 0 10m 320 40m 320 40.000001m 320 50m 320)
SYMBOL nmos 640 192 R0
SYMATTR InstName M2
SYMATTR Value IXTH88N30P
SYMBOL nmos 1056 192 R0
SYMATTR InstName M4
SYMATTR Value IXTH88N30P
SYMBOL nmos 416 80 R0
SYMATTR InstName M5
SYMATTR Value IXTH88N30P
SYMBOL res 448 -80 R0
WINDOW 0 -97 43 Left 2
WINDOW 3 -71 69 Left 2
SYMATTR InstName R_chop
SYMATTR Value 100
SYMBOL bv 2112 -1232 R0
SYMATTR InstName Back_emf1
SYMATTR Value V=200*K_emf
SYMBOL cap 176 80 R0
SYMATTR InstName C_Rect
SYMATTR Value 10µ
SYMBOL voltage -1136 -1024 R0
WINDOW 3 -221 137 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR Value PULSE(0 10 0 0.025m 0.025m 1n 0.05m)
SYMATTR InstName V_triangle
SYMBOL voltage -1536 -1024 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 -208 129 Left 2
SYMATTR InstName V_ref_1
SYMATTR Value PULSE(9.5 9.5 50m 1n 1n 1000)
SYMBOL bv -240 -992 R0
WINDOW 3 -146 129 Left 2
SYMATTR InstName V_drive_1
SYMATTR Value V{if(V(tri)<V(ref1),10,0)}
SYMBOL bv -240 -800 R0
WINDOW 3 -138 143 Left 2
SYMATTR InstName V_drive_2
SYMATTR Value V{if(V(tri)<V(ref2),0,10)}
SYMBOL voltage -1536 -784 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 -204 140 Left 2
SYMATTR InstName V_ref_2
SYMATTR Value PULSE(10 10 50m 1n 1n 1000)
SYMBOL diode 112 -112 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D_Rect
SYMBOL voltage 864 -720 R90
WINDOW 0 -54 88 VLeft 2
WINDOW 3 51 70 VLeft 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V_GS4
SYMATTR Value 10
SYMBOL bv 768 -544 R90
WINDOW 0 -32 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName V_GS5
SYMATTR Value V{V(out5)}
SYMBOL voltage -1136 -800 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 -194 135 Left 2
SYMATTR InstName V_ref_5
SYMATTR Value PULSE(0 10 82m 20m 80m 1000)
SYMBOL bv 400 -720 R90
WINDOW 0 -32 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName V_GS2
SYMATTR Value V{V(out2)}
SYMBOL bv 400 -880 R90
WINDOW 0 -32 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName V_GS1
SYMATTR Value V{V(out1)}
SYMBOL res 2208 192 R0
SYMATTR InstName R_GND1
SYMATTR Value 100Meg
SYMBOL bv 1712 -96 R0
SYMATTR InstName Back_emf_gen
SYMATTR Value V=I(Sense_wm)*K_emf
SYMBOL voltage 2944 96 R0
SYMATTR InstName Sense_Ia1
SYMATTR Value 0
SYMBOL voltage 3728 16 R0
SYMATTR InstName Sense_wm1
SYMATTR Value 0
SYMBOL ind 2928 -384 R0
SYMATTR InstName Motor_inductance1
SYMATTR Value {L_motor}
SYMBOL ind 3712 -368 R0
SYMATTR InstName Inertia_constant1
SYMATTR Value {L_inertia}
SYMBOL res 2928 -256 R0
SYMATTR InstName Motor_resistance1
SYMATTR Value {R_motor}
SYMBOL res 3712 -192 R0
SYMATTR InstName Friction1
SYMATTR Value {R_loss}
SYMBOL bv 3312 -384 R0
SYMATTR InstName V_torque1
SYMATTR Value V=I(Sense_Ia1)*K_t
SYMBOL res 3440 192 R0
SYMATTR InstName R_GND2
SYMATTR Value 100Meg
SYMBOL bv 2944 -96 R0
SYMATTR InstName Back_emf_mot
SYMATTR Value V=I(Sense_wm1)*K_emf
SYMBOL voltage 4096 -176 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName Va_Motor
SYMATTR Value 320
SYMBOL voltage 96 48 R0
SYMATTR InstName V_DC
SYMATTR Value 100V
SYMBOL bv -240 -576 R0
WINDOW 3 -138 143 Left 2
SYMATTR InstName V_drive_5
SYMATTR Value V{if(V(tri)<V(ref5),0,10)}
TEXT -216 256 Left 2 !.tran 0 200m 0 0.005m
TEXT 2136 -104 Left 2 !.PARAM K_t=0.2\n.PARAM K_emf = 0.25\n.PARAM L_motor = 1000u\n.PARAM R_motor =1.2\n.PARAM R_loss = 0.0001\n.PARAM L_inertia =20u
TEXT 2184 336 Left 0 ;LTspice is angry when there is a floating net.
TEXT 3416 336 Left 0 ;LTspice is angry when there is a floating net.
TEXT 2000 -552 Left 5 ;DC Machine Model
TEXT 2096 -512 Left 2 ;to which driver is connected
TEXT 3272 -560 Left 5 ;DC Machine Model
TEXT 3392 -520 Left 2 ;which is coupled to the other
TEXT 48 -200 Left 0 ;D_Rect is here to ensure no reverse current\nflows to the rectifier, which is the real case.
TEXT 240 -968 Left 0 ;PWM is adjusted by comparing pulses with\na triangular wave, then applied to the gate.
TEXT 2376 -1368 Left 5 ;Recycle Bin
TEXT 200 -264 Left 5 ;Rectifier + Chopper + H-Bridge
TEXT 72 -1088 Left 5 ;Gate Driver
TEXT -1472 -1128 Left 5 ;Controller
TEXT 208 56 Left 0 ;Capacitance models the\ncapacitor at rectifier output
