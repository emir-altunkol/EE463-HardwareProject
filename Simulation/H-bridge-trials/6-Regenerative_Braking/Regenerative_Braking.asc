Version 4
SHEET 1 2940 680
WIRE 272 -592 240 -592
WIRE 384 -592 352 -592
WIRE 736 -592 704 -592
WIRE 848 -592 816 -592
WIRE 2720 -496 2304 -496
WIRE 1936 -464 1936 -512
WIRE 2304 -464 2304 -496
WIRE 2720 -448 2720 -496
WIRE 272 -432 240 -432
WIRE 384 -432 352 -432
WIRE 736 -432 704 -432
WIRE 848 -432 816 -432
WIRE 1936 -336 1936 -384
WIRE 2720 -272 2720 -368
WIRE 640 -256 608 -256
WIRE 752 -256 720 -256
WIRE 1936 -176 1936 -256
WIRE 64 -144 48 -144
WIRE 144 -144 128 -144
WIRE 320 -144 144 -144
WIRE 544 -144 320 -144
WIRE 960 -144 544 -144
WIRE 544 -112 544 -144
WIRE 960 -112 960 -144
WIRE 320 -80 320 -144
WIRE 2720 -64 2720 -192
WIRE 1936 16 1936 -96
WIRE 544 32 544 -16
WIRE 544 32 528 32
WIRE 960 32 960 -16
WIRE 960 32 944 32
WIRE 48 48 48 -144
WIRE 144 64 144 -144
WIRE 320 64 320 0
WIRE 544 80 544 32
WIRE 672 80 544 80
WIRE 960 80 960 32
WIRE 960 80 832 80
WIRE 1936 112 1936 96
WIRE 2304 112 2304 -384
WIRE 2720 112 2720 16
WIRE 2720 112 2304 112
WIRE 544 176 544 80
WIRE 960 176 960 80
WIRE 320 208 320 160
WIRE 320 208 304 208
WIRE 544 288 544 272
WIRE 544 288 528 288
WIRE 960 288 960 272
WIRE 960 288 944 288
WIRE 48 304 48 128
WIRE 144 304 144 128
WIRE 144 304 48 304
WIRE 320 304 320 208
WIRE 320 304 144 304
WIRE 544 304 544 288
WIRE 544 304 320 304
WIRE 960 304 960 288
WIRE 960 304 544 304
WIRE 48 336 48 304
FLAG 48 336 0
FLAG 496 -32 V_G1
IOPIN 496 -32 In
FLAG 496 256 V_G2
IOPIN 496 256 In
FLAG 912 -32 V_G3
IOPIN 912 -32 In
FLAG 912 256 V_G4
IOPIN 912 256 In
FLAG 944 32 V_S3
IOPIN 944 32 In
FLAG 528 32 V_S1
IOPIN 528 32 In
FLAG 528 288 V_S2
IOPIN 528 288 In
FLAG 944 288 V_S4
IOPIN 944 288 In
FLAG 384 -592 V_G1
IOPIN 384 -592 Out
FLAG 240 -592 V_S1
IOPIN 240 -592 Out
FLAG 384 -432 V_G2
IOPIN 384 -432 Out
FLAG 240 -432 V_S2
IOPIN 240 -432 Out
FLAG 848 -592 V_G3
IOPIN 848 -592 Out
FLAG 704 -592 V_S3
IOPIN 704 -592 Out
FLAG 848 -432 V_G4
IOPIN 848 -432 Out
FLAG 704 -432 V_S4
IOPIN 704 -432 Out
FLAG 1936 -512 HB+
IOPIN 1936 -512 In
FLAG 672 80 HB+
IOPIN 672 80 Out
FLAG 832 80 HB-
IOPIN 832 80 Out
FLAG 1936 112 HB-
IOPIN 1936 112 In
FLAG 272 144 V_G5
IOPIN 272 144 In
FLAG 304 208 V_S5
IOPIN 304 208 In
FLAG 752 -256 V_G5
IOPIN 752 -256 Out
FLAG 608 -256 V_S5
IOPIN 608 -256 Out
FLAG -1648 -96 0
FLAG -1520 -96 0
FLAG -1648 -176 in1
FLAG -1520 -176 in2
FLAG -1120 -96 0
FLAG -1120 -176 out1
FLAG -1120 96 0
FLAG -1120 16 out2
FLAG -1520 64 0
FLAG -1520 -16 in3
SYMBOL nmos 496 -112 R0
SYMATTR InstName M1
SYMATTR Value IXTH88N30P
SYMBOL nmos 912 -112 R0
SYMATTR InstName M3
SYMATTR Value IXTH88N30P
SYMBOL voltage -128 -432 R90
WINDOW 0 37 30 VLeft 2
WINDOW 3 -55 363 VLeft 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value PULSE(0 10 0.02866m 1p 1p 0.02134m 0.05m 400)
SYMBOL voltage -128 -576 R90
WINDOW 0 37 30 VLeft 2
WINDOW 3 -49 364 VLeft 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value PULSE(0 10 0 1p 1p 0.02866m 0.05m)
SYMBOL voltage 832 -432 R90
WINDOW 0 37 30 VLeft 2
WINDOW 3 -52 169 VLeft 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V4
SYMATTR Value 10
SYMBOL voltage 832 -592 R90
WINDOW 0 37 30 VLeft 2
WINDOW 3 -63 164 VLeft 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V3
SYMATTR Value 0
SYMBOL voltage 1936 0 R0
SYMATTR InstName V_sense_1
SYMATTR Value 0
SYMBOL voltage 2720 -80 R0
SYMATTR InstName V_sense_2
SYMATTR Value 0
SYMBOL ind 1920 -480 R0
SYMATTR InstName Motor_inductance
SYMATTR Value {L_motor}
SYMBOL ind 2704 -464 R0
SYMATTR InstName Inertia_constant
SYMATTR Value {L_inertia}
SYMBOL res 1920 -352 R0
SYMATTR InstName Motor_resistance
SYMATTR Value {R_motor}
SYMBOL res 2704 -288 R0
SYMATTR InstName Friction
SYMATTR Value {R_loss}
SYMBOL bv 2304 -480 R0
SYMATTR InstName V_torque
SYMATTR Value V=I(V_sense_1)*K_t
SYMBOL voltage 48 32 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 0 -169 9 Left 2
WINDOW 3 -688 48 Left 2
SYMATTR InstName V_DC_CONST
SYMATTR Value PWL(0 0 10m 320 40m 320 40.000001m 320 50m 320)
SYMBOL nmos 496 176 R0
SYMATTR InstName M2
SYMATTR Value IXTH88N30P
SYMBOL nmos 912 176 R0
SYMATTR InstName M4
SYMATTR Value IXTH88N30P
SYMBOL nmos 272 64 R0
SYMATTR InstName M5
SYMATTR Value IXTH88N30P
SYMBOL res 304 -96 R0
WINDOW 0 -97 43 Left 2
WINDOW 3 -71 69 Left 2
SYMATTR InstName R_chop
SYMATTR Value 1
SYMBOL voltage 736 -256 R90
WINDOW 0 37 30 VLeft 2
WINDOW 3 -53 95 VLeft 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V5
SYMATTR Value PULSE(0 10 52m 1n 1n 10)
SYMBOL bv 1936 -192 R0
SYMATTR InstName Back_emf1
SYMATTR Value V=I(V_sense_2)*K_emf
SYMBOL cap 128 64 R0
SYMATTR InstName C1
SYMATTR Value 10µ
SYMBOL voltage -1648 -192 R0
WINDOW 3 -517 82 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR Value PULSE(0 10 0 0.025m 0.025m 1n 0.05m)
SYMATTR InstName V6
SYMBOL voltage -1520 -192 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V11
SYMATTR Value PULSE(5 3 50m 1n 1n 1000s)
SYMBOL bv -1120 -192 R0
SYMATTR InstName B1
SYMATTR Value V{if(V(in1)<V(in2),10,0)}
SYMBOL bv -1120 0 R0
SYMATTR InstName B2
SYMATTR Value V{if(V(in1)<V(in3),0,10)}
SYMBOL voltage -1520 -32 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V7
SYMATTR Value PULSE(5.5 3.5 50m 1n 1n 1000s)
SYMBOL bv 368 -592 R90
WINDOW 0 -32 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName B3
SYMATTR Value V=V(out1)
SYMBOL bv 368 -432 R90
WINDOW 0 -32 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName B4
SYMATTR Value V=V(out2)
SYMBOL diode 64 -128 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D1
TEXT -264 240 Left 2 !.tran 0 80m 0 0.005m
TEXT 2360 -200 Left 2 !.PARAM K_t=0.2\n.PARAM K_emf = 0.25\n.PARAM L_motor = 1000u\n.PARAM R_motor =1.2\n.PARAM R_loss = 0.0001\n.PARAM L_inertia =20u
